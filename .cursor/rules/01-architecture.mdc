# Architecture Rules

## Frame ownership
- `apps/shell` owns and renders the global AppFrame exactly once:
  - Header
  - Sidebar
  - main layout container
- Domain remotes must not render their own global frame.

## Apps
- `apps/platform` is the core remote providing:
  - `AppProviders` (QueryClientProvider wrapper)
  - `getQueryClient()` singleton
  - account access (`useAccount`, `prefetchAccount`)
- `apps/traffic`, `apps/reports`, `apps/admin` are domain remotes that expose `./routes`.

## Shared state (Account)
- Account must be fetched once and shared via TanStack Query cache.
- Remotes must import `useAccount()` from `platform/account`.
- Shell must prefetch account at startup and show account name in the Header.

## Domain creation
- New remotes are created via `pnpm domain:create`.
- The creator must wire the new remote into:
  - shell MF remotes (rspack.config.js)
  - shell route/nav manifest (remote-manifest.tsx)

## Router ownership
- `apps/shell` owns the ONLY TanStack Router instance.
- Domain remotes export route configs; they never create routers.

## Frame ownership
- Shell renders Header, Sidebar, and Layout exactly once.
- Remotes render only page content.

## Platform ownership
- Platform owns:
  - QueryClient singleton
  - AppProviders
  - Account fetching logic
